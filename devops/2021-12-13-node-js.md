---
layout: default
title: NodeJS Deploy
nav_order: 80
---

# PHP Symfony Deploy

# Установка
---
Сборка проекта

```
useradd -s /bin/bash -d /home/node node
su - node

git clone https://github.com/nodejs/nodejs.org.git

curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash

nvm install v14.17.5
nvm use v14.17.5

cd nodejs.org/

npm install

exit

```

Установка и настрока nginx
```
apt install -y certbot nginx 

systemctl enable nginx
systemctl stop nginx  # останавливаем чтобы получить сертификат через certbot в standalone режиме

certbot certonly -d nur76n-dev.devops.rebrain.srwx.net

rm /etc/nginx/sites-enabled/default  
```
Содержимое конфиг файла nginx /etc/nginx/sites-enabled/node
```
map $http_accept_language $index_redirect_uri {
	default "/en/";
	"~(^|,)en.+,ru" "/en/";
	"~(^|,)ru.+,en" "/ru/";
	"~(^|,)en" "/en/";
	"~(^|,)ru" "/ru/";
}

server {
	listen 80;

	server_name nur76n-dev.devops.rebrain.srwx.net;

	location / {
		return 301 https://$host$request_uri;
	}
}

server {
	listen 443 ssl;

	root /home/node/nodejs.org/build;

	index index.html;

	server_name nur76n-dev.devops.rebrain.srwx.net;

	ssl_certificate /etc/letsencrypt/live/nur76n-dev.devops.rebrain.srwx.net/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/nur76n-dev.devops.rebrain.srwx.net/privkey.pem; 

	location = / {
		return 302 $index_redirect_uri;
	}

	location / {
		try_files $uri $uri/ =404;
	}	
}

```
Запуск nginx
```
nginx -t
systemctl start nginx
```
